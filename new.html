<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced HTML Email Replacer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3a0ca3;
      --accent-color: #4cc9f0;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --success-color: #2ecc71;
      --error-color: #e74c3c;
      --warning-color: #f39c12;
      --border-radius: 8px;
      --box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: var(--dark-color);
      background-color: #f0f2f5;
      padding: 0;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .container {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 2.5rem;
      width: 100%;
      max-width: 600px;
      margin: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
    }
    
    h1 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 1.8rem;
      font-size: 2rem;
      font-weight: 700;
      position: relative;
      display: inline-block;
      width: 100%;
    }
    
    h1::after {
      content: '';
      display: block;
      width: 60px;
      height: 4px;
      background: var(--accent-color);
      margin: 0.5rem auto 0;
      border-radius: 2px;
    }
    
    .form-group {
      margin-bottom: 1.8rem;
      position: relative;
    }
    
    label {
      display: block;
      margin-bottom: 0.6rem;
      font-weight: 600;
      color: var(--secondary-color);
      font-size: 0.95rem;
    }
    
    input, button, textarea {
      width: 100%;
      padding: 0.85rem 1rem;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      padding: 1rem;
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    
    .file-input-wrapper input[type="file"] {
      position: absolute;
      font-size: 100px;
      opacity: 0;
      right: 0;
      top: 0;
      cursor: pointer;
    }
    
    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85rem 1rem;
      border: 2px dashed #ddd;
      border-radius: var(--border-radius);
      background-color: var(--light-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .file-input-label:hover {
      border-color: var(--accent-color);
      background-color: rgba(76, 201, 240, 0.05);
    }
    
    .file-name {
      color: #666;
      font-style: italic;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0.25rem 0;
    }
    
    .status {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: var(--border-radius);
      display: none;
      align-items: center;
      gap: 0.75rem;
    }
    
    .status.success {
      background-color: rgba(46, 204, 113, 0.1);
      color: var(--success-color);
      border: 1px solid var(--success-color);
      display: flex;
    }
    
    .status.error {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--error-color);
      border: 1px solid var(--error-color);
      display: flex;
    }
    
    .status.warning {
      background-color: rgba(243, 156, 18, 0.1);
      color: var(--warning-color);
      border: 1px solid var(--warning-color);
      display: flex;
    }
    
    .info-text {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0.5rem;
      line-height: 1.5;
    }
    
    .old-email-container {
      background-color: #fff8e1;
      padding: 1rem;
      border-radius: var(--border-radius);
      margin: 1rem 0;
      border-left: 4px solid var(--warning-color);
    }
    
    .old-email-label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--warning-color);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .old-email {
      font-family: 'Courier New', Courier, monospace;
      word-break: break-all;
      color: #d35400;
    }
    
    .replace-count {
      font-size: 0.75rem;
      background-color: var(--primary-color);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      margin-left: 0.5rem;
    }
    
    .settings-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      margin: 1.5rem 0 1rem;
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .advanced-settings {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      border-radius: var(--border-radius);
    }
    
    .advanced-settings.active {
      max-height: 500px;
      margin-bottom: 1.5rem;
    }
    
    .toggle-icon {
      transition: transform 0.3s ease;
    }
    
    .toggle-icon.active {
      transform: rotate(180deg);
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin: 0.75rem 0;
    }
    
    .checkbox-group input {
      width: auto;
      margin-right: 0.75rem;
    }
    
    .checkbox-group label {
      margin-bottom: 0;
    }
    
    .loading {
      display: none;
      text-align: center;
      margin: 1.5rem 0;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .preview-container {
      margin-top: 1.5rem;
      border: 1px solid #eee;
      border-radius: var(--border-radius);
      padding: 1rem;
      max-height: 200px;
      overflow-y: auto;
      background-color: #f9f9f9;
      display: none;
    }
    
    .preview-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--secondary-color);
    }
    
    .preview-content {
      font-family: monospace;
      font-size: 0.8rem;
      white-space: pre-wrap;
      color: #333;
    }
    
    .highlight {
      background-color: #fff3cd;
      padding: 0 2px;
    }
    
    @media (max-width: 600px) {
      .container {
        padding: 1.5rem;
        margin: 1rem;
      }
      
      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Advanced HTML Email Replacer</h1>
    
    <div class="form-group">
      <label for="fileInput">Select HTML File</label>
      <div class="file-input-wrapper">
        <input type="file" id="fileInput" accept=".html,.htm">
        <div class="file-input-label">
          <span>Choose HTML file...</span>
          <i class="fas fa-file-upload"></i>
        </div>
      </div>
      <div id="fileName" class="file-name">No file selected</div>
    </div>
    
    <div class="form-group">
      <label for="newEmail">New Email Address</label>
      <input type="email" id="newEmail" placeholder="Enter new email (e.g. user@example.com)">
      <p class="info-text">This will replace all instances of the old email address in your HTML file.</p>
    </div>
    
    <div class="old-email-container">
      <div class="old-email-label">
        <i class="fas fa-exclamation-circle"></i>
        <span>Current Email to Replace</span>
        <span id="replaceCount" class="replace-count" style="display: none;">0 found</span>
      </div>
      <div class="old-email" id="oldEmailDisplay">kiddxxq1@gmail.com</div>
    </div>
    
    <div class="settings-toggle" id="settingsToggle">
      <span><i class="fas fa-cog"></i> Advanced Settings</span>
      <i class="fas fa-chevron-down toggle-icon"></i>
    </div>
    
    <div class="advanced-settings" id="advancedSettings">
      <div class="form-group">
        <label for="oldEmail">Custom Email to Replace</label>
        <input type="text" id="oldEmail" placeholder="Leave blank to use default">
        <p class="info-text">Specify a different email address to replace if needed.</p>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="caseSensitive" checked>
        <label for="caseSensitive">Case sensitive replacement</label>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="preserveFormatting" checked>
        <label for="preserveFormatting">Preserve original formatting</label>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="showPreview">
        <label for="showPreview">Show preview before download</label>
      </div>
    </div>
    
    <button id="processBtn" onclick="processFile()">
      <i class="fas fa-sync-alt"></i>
      Replace Email and Download
    </button>
    
    <div class="loading" id="loadingIndicator">
      <div class="spinner"></div>
      <p>Processing your file...</p>
    </div>
    
    <div id="statusMessage" class="status"></div>
    
    <div class="preview-container" id="previewContainer">
      <div class="preview-title">Preview of Changes:</div>
      <div class="preview-content" id="previewContent"></div>
    </div>
  </div>

  <script>
    // DOM elements
    const fileInput = document.getElementById('fileInput');
    const newEmailInput = document.getElementById('newEmail');
    const oldEmailInput = document.getElementById('oldEmail');
    const processBtn = document.getElementById('processBtn');
    const statusMessage = document.getElementById('statusMessage');
    const fileNameDisplay = document.getElementById('fileName');
    const oldEmailDisplay = document.getElementById('oldEmailDisplay');
    const replaceCountDisplay = document.getElementById('replaceCount');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const previewContainer = document.getElementById('previewContainer');
    const previewContent = document.getElementById('previewContent');
    const settingsToggle = document.getElementById('settingsToggle');
    const advancedSettings = document.getElementById('advancedSettings');
    const caseSensitiveCheckbox = document.getElementById('caseSensitive');
    const preserveFormattingCheckbox = document.getElementById('preserveFormatting');
    const showPreviewCheckbox = document.getElementById('showPreview');

    // Default old email
    const DEFAULT_OLD_EMAIL = "kiddxxq1@gmail.com";
    let currentOldEmail = DEFAULT_OLD_EMAIL;
    let replacementCount = 0;

    // Event listeners
    fileInput.addEventListener('change', handleFileSelect);
    newEmailInput.addEventListener('input', validateInputs);
    oldEmailInput.addEventListener('input', updateOldEmail);
    settingsToggle.addEventListener('click', toggleAdvancedSettings);
    showPreviewCheckbox.addEventListener('change', togglePreviewVisibility);

    // Initialize
    function init() {
      updateOldEmail();
      validateInputs();
    }

    // Handle file selection
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) {
        fileNameDisplay.textContent = file.name;
        
        // Check if the file is HTML
        if (!file.name.match(/\.html?$/i)) {
          showWarning("The selected file may not be HTML. Please check the file extension.");
        } else {
          // Read the file to count occurrences
          readFileForPreview(file);
        }
      } else {
        fileNameDisplay.textContent = 'No file selected';
        replaceCountDisplay.style.display = 'none';
      }
      validateInputs();
    }

    // Read file for preview and count occurrences
    function readFileForPreview(file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const content = e.target.result;
        countEmailOccurrences(content);
      };
      
      reader.onerror = function() {
        console.error("Error reading file for preview");
      };
      
      reader.readAsText(file);
    }

    // Count email occurrences in content
    function countEmailOccurrences(content) {
      const regex = new RegExp(escapeRegExp(currentOldEmail), caseSensitiveCheckbox.checked ? 'g' : 'gi');
      const matches = content.match(regex);
      replacementCount = matches ? matches.length : 0;
      
      if (replacementCount > 0) {
        replaceCountDisplay.textContent = `${replacementCount} found`;
        replaceCountDisplay.style.display = 'inline-block';
        replaceCountDisplay.style.backgroundColor = replacementCount > 0 ? 
          (replacementCount > 10 ? '#e74c3c' : '#2ecc71') : '#95a5a6';
      } else {
        replaceCountDisplay.style.display = 'none';
      }
    }

    // Update old email based on input
    function updateOldEmail() {
      currentOldEmail = oldEmailInput.value.trim() || DEFAULT_OLD_EMAIL;
      oldEmailDisplay.textContent = currentOldEmail;
      
      // If we have a file selected, recount occurrences
      if (fileInput.files.length) {
        readFileForPreview(fileInput.files[0]);
      }
    }

    // Validate form inputs
    function validateInputs() {
      const isValid = fileInput.files.length > 0 && 
                    newEmailInput.value.trim() !== '' && 
                    isValidEmail(newEmailInput.value.trim());
      
      processBtn.disabled = !isValid;
      return isValid;
    }

    // Email validation
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // Toggle advanced settings
    function toggleAdvancedSettings() {
      advancedSettings.classList.toggle('active');
      document.querySelector('#settingsToggle .toggle-icon').classList.toggle('active');
    }

    // Toggle preview visibility
    function togglePreviewVisibility() {
      if (showPreviewCheckbox.checked && fileInput.files.length) {
        previewContainer.style.display = 'block';
        generatePreview(fileInput.files[0]);
      } else {
        previewContainer.style.display = 'none';
      }
    }

    // Generate preview
    function generatePreview(file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        let content = e.target.result;
        const regex = new RegExp(escapeRegExp(currentOldEmail), caseSensitiveCheckbox.checked ? 'g' : 'gi');
        
        // Create preview with highlighted matches
        const previewText = content.length > 1000 
          ? content.substring(0, 1000) + '...' 
          : content;
        
        const highlightedText = previewText.replace(regex, match => 
          `<span class="highlight">${match}</span>`
        );
        
        previewContent.innerHTML = highlightedText;
      };
      
      reader.readAsText(file);
    }

    // Main processing function
    function processFile() {
      if (!validateInputs()) return;
      
      const file = fileInput.files[0];
      const newEmail = newEmailInput.value.trim();
      const showPreview = showPreviewCheckbox.checked;
      
      // Show loading indicator
      loadingIndicator.style.display = 'block';
      processBtn.disabled = true;
      statusMessage.className = 'status';
      statusMessage.textContent = '';
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          let content = e.target.result;
          
          // Check if the old email exists in the file
          const regex = new RegExp(escapeRegExp(currentOldEmail), caseSensitiveCheckbox.checked ? 'g' : 'gi');
          if (!regex.test(content)) {
            showError(`The file does not contain the email "${currentOldEmail}" to replace.`);
            loadingIndicator.style.display = 'none';
            processBtn.disabled = false;
            return;
          }
          
          // Replace the email
          const updatedContent = preserveFormattingCheckbox.checked
            ? content.replace(regex, match => {
                // Preserve original case of the email being replaced
                return match.toLowerCase() === currentOldEmail.toLowerCase()
                  ? newEmail
                  : newEmail.charAt(0).toUpperCase() + newEmail.slice(1);
              })
            : content.replace(regex, newEmail);
          
          // If preview is requested, show it instead of downloading immediately
          if (showPreview) {
            showSuccess(`Email replacement complete. ${replacementCount} instances replaced.`);
            previewContainer.style.display = 'block';
            previewContent.textContent = updatedContent.length > 1000 
              ? updatedContent.substring(0, 1000) + '...' 
              : updatedContent;
            createDownloadButton(file.name, updatedContent);
          } else {
            downloadFile(file.name, updatedContent);
            showSuccess(`Email replaced successfully! ${replacementCount} instances replaced. Download started.`);
            
            // Open the URL after successful download
            setTimeout(() => {
              window.open('https://otieu.com/4/9515888', '_blank');
            }, 1000);
          }
        } catch (error) {
          showError("An error occurred while processing the file: " + error.message);
        } finally {
          loadingIndicator.style.display = 'none';
          processBtn.disabled = false;
        }
      };
      
      reader.onerror = function() {
        showError("Error reading the file. Please try again.");
        loadingIndicator.style.display = 'none';
        processBtn.disabled = false;
      };
      
      reader.readAsText(file);
    }

    // Create download button for preview
    function createDownloadButton(originalFilename, content) {
      // Remove existing download button if it exists
      const existingBtn = document.getElementById('downloadPreviewBtn');
      if (existingBtn) existingBtn.remove();
      
      const btn = document.createElement('button');
      btn.id = 'downloadPreviewBtn';
      btn.innerHTML = '<i class="fas fa-download"></i> Download Processed File';
      btn.onclick = () => {
        downloadFile(originalFilename, content);
        // Open the URL after download when clicked from preview
        setTimeout(() => {
          window.open('https://otieu.com/4/9515888', '_blank');
        }, 1000);
      };
      btn.style.marginTop = '1rem';
      
      previewContainer.appendChild(btn);
    }

    // Download file
    function downloadFile(originalFilename, content) {
      const blob = new Blob([content], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement("a");
      a.href = url;
      a.download = originalFilename.replace(/\.html?$/i, "_updated.html");
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      URL.revokeObjectURL(url);
    }

    // Helper function to escape regex special characters
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Show status messages
    function showSuccess(message) {
      statusMessage.className = 'status success';
      statusMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    }
    
    function showError(message) {
      statusMessage.className = 'status error';
      statusMessage.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
    }
    
    function showWarning(message) {
      statusMessage.className = 'status warning';
      statusMessage.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
    }

    // Initialize the app
    init();
  </script>
</body>
</html>