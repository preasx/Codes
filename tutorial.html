<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Keep all previous head content until script] -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Initializing university video selector (domain-safe version)...');
      
      const urlParams = new URLSearchParams(window.location.search);
      const title = (urlParams.get('title') || '').toLowerCase();
      const description = (urlParams.get('description') || '').toLowerCase();

      // Set page content
      document.getElementById('tutorialTitle').textContent = decodeURIComponent(title);
      document.getElementById('contentTitle').textContent = `${decodeURIComponent(title)} Tutorial`;
      document.getElementById('contentDescription').textContent = decodeURIComponent(description);

      // University video mappings (now with priority order)
      const universityPatterns = [
        // Highest priority - full names
        { pattern: 'university of johannesburg', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'university of limpopo', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'university of fort hare', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'university of kwazulu-natal', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'durban university of technology', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'university of venda', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'tshwane university of technology', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        
        // Medium priority - common abbreviations
        { pattern: 'uj', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'ul', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'ufh', videoId: '1-RkZaXQvzSLWFKCl8fAuN9pnhWLz8knn' },
        { pattern: 'ukzn', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'dut', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'univen', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' },
        { pattern: 'tut', videoId: '1-PyMD1OSR68xRz1QfmhAkGQ1fjMoR_3G' }
      ];

      // Detect university from title/description only (no URL)
      function detectUniversity() {
        const searchText = `${title} ${description}`;
        console.log('Scanning title/description:', searchText);

        // Check for matches in priority order
        for (const uni of universityPatterns) {
          if (searchText.includes(uni.pattern)) {
            console.log(`Matched "${uni.pattern}" -> Video ${uni.videoId}`);
            return uni.videoId;
          }
        }
        
        console.log('No university match found');
        return null;
      }

      // Set up the video player
      function setupVideoPlayer() {
        const videoId = detectUniversity();
        const videoContainer = document.getElementById('videoContainer');
        const watchBtn = document.getElementById('watchTutorial');

        if (videoId) {
          videoContainer.innerHTML = `
            <iframe src="https://drive.google.com/file/d/${videoId}/preview" 
                    allow="autoplay; fullscreen" 
                    allowfullscreen
                    style="width:100%;height:100%;border:none;"></iframe>`;
          
          watchBtn.href = `https://drive.google.com/file/d/${videoId}/view`;
          watchBtn.onclick = null;
        } else {
          videoContainer.innerHTML = `
            <div class="video-placeholder">
              University not detected
              <div style="font-size:0.8em;margin-top:10px;">
                Please include your university name in the title/description
              </div>
            </div>`;
          
          watchBtn.onclick = function(e) {
            e.preventDefault();
            const exampleCodes = universityPatterns
              .filter(uni => uni.pattern.length <= 4)
              .map(uni => uni.pattern)
              .join(', ');
            
            alert(`Please include one of these university codes in your title/description:\n\n${exampleCodes}`);
          };
        }
      }

      // Initialize
      setupVideoPlayer();
    });
  </script>
</head>
<body>
  <!-- [Keep all existing body content] -->
</body>
</html>